<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Deskdoc - Patient Management</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --light: #f4f7f6;
            --white: #ffffff;
            --danger: #e74c3c;
            --success: #27ae60;
            --highlight: #f1c40f;
            --pending: #95a5a6;
            --ongoing: #e67e22;
            --shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: var(--light); padding-bottom: 60px; color: var(--primary); }
        header { background: var(--primary); color: var(--white); padding: 1.2rem; text-align: center; position: sticky; top: 0; z-index: 1000; box-shadow: var(--shadow); }
        .container { max-width: 1200px; margin: 0 auto; padding: 15px; }

        .tabs { display: flex; background: var(--white); position: sticky; top: 65px; z-index: 999; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .tab { flex: 1; text-align: center; padding: 15px; font-weight: bold; color: #95a5a6; cursor: pointer; transition: 0.3s; }
        .active-tab { color: var(--accent); border-bottom: 4px solid var(--accent); background: rgba(52, 152, 219, 0.05); }

        .responsive-grid { display: grid; grid-template-columns: 1fr; gap: 20px; }
        @media (min-width: 900px) { .responsive-grid { grid-template-columns: 1fr 1fr; } .full-width { grid-column: span 2; } }

        .card { background: var(--white); padding: 20px; border-radius: 12px; box-shadow: var(--shadow); margin-bottom: 10px; }
        h2 { margin-top: 0; font-size: 1.1rem; color: var(--primary); border-left: 4px solid var(--accent); padding-left: 10px; }

        input, button, textarea, select { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        button { background: var(--accent); color: var(--white); border: none; font-weight: bold; cursor: pointer; }

        .calendar-grid { display: grid !important; grid-template-columns: repeat(7, 1fr) !important; gap: 5px; background: #eee; border: 1px solid #ddd; }
        .weekday { background: #ecf0f1; font-weight: bold; font-size: 0.8rem; padding: 10px 0; text-align: center; }
        .day { background: var(--white); display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 1rem; cursor: pointer; position: relative; min-height: 50px; border: 2px solid transparent; }
        .today { background: var(--accent) !important; color: white !important; font-weight: bold; }
        .selected-day { border: 2px solid var(--highlight) !important; }
        .apt-count { background: var(--highlight); color: #000; font-size: 0.7rem; padding: 2px 6px; border-radius: 10px; margin-top: 4px; font-weight: bold; }

        .item { border-left: 5px solid var(--accent); background: #fff; padding: 15px; margin-bottom: 10px; border-radius: 0 8px 8px 0; display: flex; justify-content: space-between; align-items: flex-start; }
        .status-tag { display: inline-block; padding: 3px 10px; border-radius: 20px; font-size: 0.7rem; font-weight: bold; color: white; text-transform: uppercase; margin-bottom: 5px; }
        .st-pending { background: var(--pending); }
        .st-ongoing { background: var(--ongoing); }
        .st-completed { background: var(--success); }
        .st-cancel { background: var(--danger); }

        .action-btns { display: flex; flex-direction: column; gap: 5px; }
        .btn-action { width: 85px; padding: 8px; font-size: 0.7rem; border-radius: 6px; }

        .stats-bar { background: var(--primary); color: white; padding: 15px; border-radius: 12px; display: flex; justify-content: space-around; text-align: center; margin-bottom: 20px; flex-wrap: wrap; gap: 10px; }
        .stat-item div:first-child { font-size: 0.75rem; opacity: 0.8; }
        .stat-item div:last-child { font-size: 1.1rem; font-weight: bold; }

        #invoice-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: white;
            z-index: 2000;
            padding: 20px;
            box-sizing: border-box;
            overflow-y: auto;
        }

        @media print {
            body > *:not(#invoice-overlay) { display: none !important; }
            #invoice-overlay { display: block !important; position: relative; padding: 0; }
            .no-print { display: none !important; }
        }
        
        /* Jump to date styles */
        .jump-btn { background: none; color: var(--primary); padding: 0; width: auto; font-size: 1.2rem; cursor: pointer; border-radius: 5px; }
        .jump-btn:hover { color: var(--accent); }
    </style>
</head>
<body>

<header>
    <h1>Deskdoc</h1>
</header>

<div class="tabs no-print">
    <div id="tab1" class="tab active-tab" onclick="showPage('booking')">Booking</div>
    <div id="tab2" class="tab" onclick="showPage('storage')">History</div>
    <div id="tab3" class="tab" onclick="showPage('billing')">Revenue</div>
</div>

<div class="container no-print">
    <div id="bookingPage">
        <div class="responsive-grid">
            <div class="card">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                    <button onclick="changeMonth(-1)" style="width:auto; padding:5px 15px;">&lt;</button>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <h2 id="monthDisplay" style="border:none; margin:0;"></h2>
                        <button class="jump-btn" onclick="document.getElementById('jumpPicker').showPicker()" title="Jump to Date">ðŸ“…</button>
                        <input type="month" id="jumpPicker" style="position: absolute; opacity: 0; pointer-events: none; width: 0;" onchange="jumpToDate(this.value)">
                    </div>
                    <button onclick="changeMonth(1)" style="width:auto; padding:5px 15px;">&gt;</button>
                </div>
                <div class="calendar-grid">
                    <div class="weekday">Su</div><div class="weekday">Mo</div><div class="weekday">Tu</div>
                    <div class="weekday">We</div><div class="weekday">Th</div><div class="weekday">Fr</div>
                    <div class="weekday">Sa</div>
                </div>
                <div id="calendar" class="calendar-grid"></div>
            </div>

            <div class="card">
                <h2 id="formTitle">Patient Intake</h2>
                <select id="clinicSelect">
                    <option value="">-- Select Saved Clinic --</option>
                </select>
                <input type="text" id="pName" placeholder="Patient Full Name">
                <input type="tel" id="pPhone" placeholder="Mobile Number">
                <div style="display:flex; gap:10px;">
                    <input type="date" id="pDate" onchange="syncCalendarWithPicker(this.value); renderPatients();">
                    <input type="time" id="pTime">
                </div>
                <div style="display:flex; gap:10px;">
                    <input type="number" id="pFee" placeholder="Total Fee">
                    <input type="number" id="pPaid" placeholder="Paid">
                </div>
                <select id="pStatus">
                    <option value="pending">Pending</option>
                    <option value="ongoing">Ongoing</option>
                    <option value="completed">Completed</option>
                    <option value="cancel">Cancelled</option>
                </select>
                <textarea id="pCondition" placeholder="Diagnosis / Notes" rows="2"></textarea>
                <button id="saveBtn" onclick="savePatient()">Save to Deskdoc</button>
                <button id="cancelEdit" style="display:none; background:#95a5a6;" onclick="resetForm()">Cancel</button>
            </div>

            <div class="card full-width">
                <h2 id="listHeader">Schedule <button onclick="refreshApp()" style="width:auto; padding:5px 10px; font-size:10px; float:right;">Today</button></h2>
                <div id="patientList"></div>
            </div>
        </div>
    </div>

    <div id="storagePage" style="display:none;">
        <div class="stats-bar">
            <div class="stat-item"><div>Total Patients</div><div id="totalCountDisplay">0</div></div>
            <div style="display:flex; gap:5px;">
                <button onclick="exportToCSV()" style="width:auto; background:var(--success); padding:8px 15px; border-radius:8px;">Export</button>
                <button onclick="document.getElementById('importFile').click()" style="width:auto; background:var(--highlight); color:black; padding:8px 15px; border-radius:8px;">Import</button>
                <input type="file" id="importFile" style="display:none" accept=".csv" onchange="importFromCSV(event)">
            </div>
        </div>
        
        <div class="card">
            <h2>Manage Clinics</h2>
            <div style="display:flex; gap:10px;">
                <input type="text" id="newClinicInput" placeholder="Add New Clinic Name" style="margin:0;">
                <button onclick="addClinic()" style="width:auto; padding:0 20px;">Add</button>
            </div>
            <div id="clinicList" style="margin-top:10px;"></div>
        </div>

        <div class="card">
            <input type="text" id="searchInput" placeholder="Search records by name..." onkeyup="applyFilters()">
            <div id="fullDatabaseList"></div>
        </div>

        <div class="card" style="border: 2px solid var(--danger); background: #fff5f5;">
            <h2 style="color: var(--danger); border-left-color: var(--danger);">Danger Zone</h2>
            <p style="font-size: 0.85rem; margin-bottom: 15px;">Warning: This will permanently delete all patient data and clinic names. Export your data before resetting.</p>
            <button onclick="factoryReset()" style="background: var(--danger); width: auto; padding: 10px 25px;">Reset All App Data</button>
        </div>
    </div>

    <div id="billingPage" style="display:none;">
        <div class="stats-bar">
            <div class="stat-item"><div>Revenue</div><div id="totalRevenue">0</div></div>
            <div class="stat-item"><div>Collected</div><div id="totalCollected">0</div></div>
            <div class="stat-item"><div>Dues</div><div id="totalDues">0</div></div>
        </div>
        <div id="billingList"></div>
    </div>
</div>

<div id="invoice-overlay">
    <button class="no-print" onclick="closeInvoice()" style="background:var(--danger); width:auto; padding:10px 20px; margin-bottom:20px;">Back to App</button>
    <button class="no-print" onclick="window.print()" style="background:var(--success); width:auto; padding:10px 20px; margin-bottom:20px; float:right;">Confirm Print / PDF</button>
    
    <div style="clear:both; border:1px solid #ccc; padding:30px; background:white;">
        <div style="text-align: center; border-bottom: 2px solid #333; padding-bottom: 20px; margin-bottom: 20px;">
            <h1 id="inv-clinic" style="margin: 0; color: #2c3e50; text-transform: uppercase;">CLINIC NAME</h1>
            <p style="margin: 5px 0;">Official Patient Receipt</p>
        </div>
        <div style="display: flex; justify-content: space-between; margin-bottom: 30px;">
            <div>
                <p><strong>Patient:</strong> <span id="inv-name"></span></p>
                <p><strong>Contact:</strong> <span id="inv-phone"></span></p>
            </div>
            <div style="text-align: right;">
                <p><strong>Date:</strong> <span id="inv-date"></span></p>
                <p><strong>Time:</strong> <span id="inv-time"></span></p>
            </div>
        </div>
        <table style="width: 100%; border-collapse: collapse; margin-bottom: 30px;">
            <thead>
                <tr style="background: #eee;">
                    <th style="border: 1px solid #ddd; padding: 12px; text-align: left;">Service Description</th>
                    <th style="border: 1px solid #ddd; padding: 12px; text-align: right;">Amount</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td style="border: 1px solid #ddd; padding: 12px;">Consultation / Treatment Session</td>
                    <td style="border: 1px solid #ddd; padding: 12px; text-align: right;" id="inv-fee">0</td>
                </tr>
                <tr style="font-weight: bold;">
                    <td style="border: 1px solid #ddd; padding: 12px; text-align: right;">Total Paid:</td>
                    <td style="border: 1px solid #ddd; padding: 12px; text-align: right; color: green;" id="inv-paid">0</td>
                </tr>
                <tr style="font-weight: bold;">
                    <td style="border: 1px solid #ddd; padding: 12px; text-align: right;">Balance Due:</td>
                    <td style="border: 1px solid #ddd; padding: 12px; text-align: right; color: red;" id="inv-due">0</td>
                </tr>
            </tbody>
        </table>
        <div style="margin-top: 50px; text-align: center;">
            <p>Thank you for choosing our services. Wish you a speedy recovery!</p>
            <p style="font-size: 0.8rem; color: #999;">System: Deskdoc Management App</p>
            <div style="margin-top: 40px; border-top: 1px solid #ccc; width: 200px; margin-left: auto; margin-right: auto; padding-top: 5px;">Authorized Signature</div>
        </div>
    </div>
</div>

<script>
function _0x54a2(){const _0x78db67=['remove','has','<div\x20class=\x22day\x20empty\x22></div>','fullDatabaseList','long','now','storagePage','calendar','totalCollected','pPhone','random','</b><br><small>','split','toUpperCase','totalCountDisplay','<div\x20class=\x22item\x22><div\x20class=\x22item-info\x22><b>','deskdoc_dev_id','value','pStatus','Deskdoc_Export.csv','storage','inv-phone','</small></div><div\x20style=\x22text-align:right\x22>Fee:\x20','padStart','Remove\x20','getMonth','</span>','3775384GIGmCT','getDate','</span><button\x20onclick=\x22removeClinic(\x27','stringify','billingPage','<div\x20style=\x27height:100vh;\x20display:flex;\x20flex-direction:column;\x20align-items:center;\x20justify-content:center;\x20text-align:center;\x20padding:20px;\x20background:#2c3e50;\x20color:white;\x20font-family:sans-serif;\x27><h2>Unauthorized</h2><p>Invalid\x20key\x20for\x20Device\x20ID:\x20<b>','App\x20Activated!','findIndex','name','inv-time','totalRevenue','</strong>\x20|\x20<b>','substr','inv-clinic','</div>','Delete?','8nIyUrp','map','9352880iBnamh','Provide\x20Name\x20and\x20Date.','\x27)\x22>','pPaid','fee',')\x22>Invoice</button><button\x20class=\x22btn-action\x22\x20style=\x22background:var(--success)\x22\x20onclick=\x22goToEdit(','trim','pName','getFullYear','inv-paid','classList','block','1148KXGZbQ',')\x22>Edit</button></div>','inv-date','paid','setItem','clinicList','body','tab3','length','target','default','</option>','patientList','pDate','status','date','removeItem','25810392RGjfvP','files','parse','9CzvPzM','invoice-overlay','tab1','Imported\x20','\x20selected-day','getDay','getItem','onload','innerText','push','</span><br><strong>','</b></p><p>Contact:\x20+917005581380</p><button\x20onclick=\x27location.reload()\x27\x20style=\x27padding:10px\x2020px;\x20background:#3498db;\x20color:white;\x20border:none;\x20border-radius:5px;\x27>Try\x20Again</button></div>','valueAsDate','download','toISOString','Date,Time,Name,Fee,Paid,Status,Clinic\x0a','billingList','time','readAsText','--:--','result','condition','saveBtn','Save\x20to\x20Deskdoc','click','\x20today','DESKDOC\x20LICENSING\x0aDevice\x20ID:\x20','\x0aEnter\x20Key:','clinicSelect','toString','style','<span\x20class=\x22apt-count\x22>','booking','10Nfqghn','forEach','monthDisplay','cancelEdit','</b></div><div\x20class=\x22action-btns\x22><button\x20class=\x22btn-action\x22\x20style=\x22background:var(--accent)\x22\x20onclick=\x22openInvoice(','deskdoc_unlocked','pTime','deskdoc_clinics','tab2','pt_patients','DANGER:\x20This\x20will\x20delete\x20ALL\x20patients\x20and\x20ALL\x20clinic\x20names\x20forever.\x20Are\x20you\x20sure?','Update\x20Record','add','inv-name','clinic','none','innerHTML','getElementById','billing','active-tab','find','totalDues','N/A','<option\x20value=\x22','37434HZFilI','searchInput','FINAL\x20CONFIRMATION:\x20Are\x20you\x20really\x20sure?\x20This\x20cannot\x20be\x20undone.','toLowerCase','numeric','Success!','pFee','75050NAjAlf','Page','scrollTo','setMonth','1034622OfFZkQ','<div\x20class=\x22','\x20records.\x20(','filter','reverse','true','1248308oAjqjF','</b></div><button\x20class=\x22btn-action\x22\x20style=\x22background:var(--success)\x22\x20onclick=\x22goToEdit(','</small></div><button\x20class=\x22btn-action\x22\x20style=\x22background:var(--success)\x22\x20onclick=\x22goToEdit(','replace','<div\x20class=\x22item\x22><div\x20class=\x22item-info\x22><span\x20class=\x22status-tag\x20st-','newClinicInput','11yNgOFh','CLINIC\x20NAME','display','inv-due','pCondition','charCodeAt',')\x22>Del</button></div></div>','join','phone'];_0x54a2=function(){return _0x78db67;};return _0x54a2();}const _0x157245=_0x495c;(function(_0x13e753,_0x103711){const _0x219c75=_0x495c,_0x6bb6d6=_0x13e753();while(!![]){try{const _0x4732db=parseInt(_0x219c75(0x176))/0x1*(parseInt(_0x219c75(0x1ba))/0x2)+parseInt(_0x219c75(0x17a))/0x3+-parseInt(_0x219c75(0x180))/0x4*(-parseInt(_0x219c75(0x157))/0x5)+-parseInt(_0x219c75(0x16f))/0x6*(-parseInt(_0x219c75(0x1c8))/0x7)+-parseInt(_0x219c75(0x1aa))/0x8+-parseInt(_0x219c75(0x136))/0x9*(-parseInt(_0x219c75(0x1bc))/0xa)+-parseInt(_0x219c75(0x186))/0xb*(parseInt(_0x219c75(0x133))/0xc);if(_0x4732db===_0x103711)break;else _0x6bb6d6['push'](_0x6bb6d6['shift']());}catch(_0x15b9d8){_0x6bb6d6['push'](_0x6bb6d6['shift']());}}}(_0x54a2,0x93afb));function generateSecureKey(_0x563158){const _0x33c02d=_0x495c,_0x30ccde='MAGN3T1C_2026_PRO';let _0x16fcbc=_0x563158+_0x30ccde,_0x4fdd4a=_0x16fcbc[_0x33c02d(0x19b)]('')[_0x33c02d(0x17e)]()['map']((_0x2bed7a,_0x50d965)=>{const _0xb2dabf=_0x33c02d;return _0x50d965%0x2===0x0?_0x2bed7a[_0xb2dabf(0x18b)](0x0)[_0xb2dabf(0x153)](0x10):_0x2bed7a;})['join']('');return _0x4fdd4a['substring'](0x0,0xc)['toUpperCase']();}let deviceID=localStorage['getItem'](_0x157245(0x19f));!deviceID&&(deviceID='DD-'+Math['random']()[_0x157245(0x153)](0x24)[_0x157245(0x1b6)](0x2,0x6)[_0x157245(0x19c)](),localStorage['setItem'](_0x157245(0x19f),deviceID));if(localStorage[_0x157245(0x13c)](_0x157245(0x15c))!==_0x157245(0x17f)){let userKey=prompt(_0x157245(0x150)+deviceID+_0x157245(0x151));if(userKey===generateSecureKey(deviceID))localStorage['setItem']('deskdoc_unlocked',_0x157245(0x17f)),alert(_0x157245(0x1b0));else{document[_0x157245(0x1ce)][_0x157245(0x167)]=_0x157245(0x1af)+deviceID+_0x157245(0x141);throw new Error('Locked');}}let patients=JSON['parse'](localStorage[_0x157245(0x13c)](_0x157245(0x160)))||[],clinics=JSON[_0x157245(0x135)](localStorage['getItem'](_0x157245(0x15e)))||[],currentViewDate=new Date(),editId=null;function showPage(_0x40a9b9){const _0x579240=_0x157245;['bookingPage',_0x579240(0x195),_0x579240(0x1ae)][_0x579240(0x158)](_0x268fcc=>document[_0x579240(0x168)](_0x268fcc)[_0x579240(0x154)][_0x579240(0x188)]='none'),document[_0x579240(0x168)](_0x40a9b9+_0x579240(0x177))[_0x579240(0x154)][_0x579240(0x188)]=_0x579240(0x1c7),[_0x579240(0x138),_0x579240(0x15f),_0x579240(0x1cf)][_0x579240(0x158)](_0x11c3cd=>document[_0x579240(0x168)](_0x11c3cd)['classList'][_0x579240(0x18f)]('active-tab'));if(_0x40a9b9===_0x579240(0x156))document[_0x579240(0x168)](_0x579240(0x138))[_0x579240(0x1c6)][_0x579240(0x163)]('active-tab');_0x40a9b9===_0x579240(0x1a3)&&(document[_0x579240(0x168)](_0x579240(0x15f))[_0x579240(0x1c6)]['add'](_0x579240(0x16a)),renderStorage(),renderClinics()),_0x40a9b9===_0x579240(0x169)&&(document[_0x579240(0x168)]('tab3')[_0x579240(0x1c6)][_0x579240(0x163)](_0x579240(0x16a)),renderBilling());}function addClinic(){const _0x282b79=_0x157245,_0x45b1bb=document['getElementById'](_0x282b79(0x185))[_0x282b79(0x1a0)][_0x282b79(0x1c2)]();_0x45b1bb&&!clinics['includes'](_0x45b1bb)&&(clinics['push'](_0x45b1bb),localStorage[_0x282b79(0x1cc)](_0x282b79(0x15e),JSON[_0x282b79(0x1ad)](clinics)),document['getElementById'](_0x282b79(0x185))['value']='',renderClinics());}function removeClinic(_0x113b7a){const _0x6a365d=_0x157245;confirm(_0x6a365d(0x1a7)+_0x113b7a+'?')&&(clinics=clinics[_0x6a365d(0x17d)](_0x3b7315=>_0x3b7315!==_0x113b7a),localStorage[_0x6a365d(0x1cc)]('deskdoc_clinics',JSON[_0x6a365d(0x1ad)](clinics)),renderClinics());}function renderClinics(){const _0x360411=_0x157245,_0xf74969=document[_0x360411(0x168)](_0x360411(0x152)),_0xa60324=document['getElementById'](_0x360411(0x1cd)),_0x3a5e4c=_0xf74969[_0x360411(0x1a0)];_0xf74969['innerHTML']='<option\x20value=\x22\x22>--\x20Select\x20Clinic\x20--</option>'+clinics[_0x360411(0x1bb)](_0x44a815=>_0x360411(0x16e)+_0x44a815+'\x22>'+_0x44a815+_0x360411(0x1d3))[_0x360411(0x18d)](''),_0xf74969[_0x360411(0x1a0)]=_0x3a5e4c,_0xa60324[_0x360411(0x167)]=clinics[_0x360411(0x1bb)](_0x2034a3=>'<div\x20style=\x22display:flex;\x20justify-content:space-between;\x20align-items:center;\x20background:#f9f9f9;\x20padding:8px\x2012px;\x20margin-bottom:5px;\x20border-radius:5px;\x20border:1px\x20solid\x20#eee;\x22><span>'+_0x2034a3+_0x360411(0x1ac)+_0x2034a3+'\x27)\x22\x20style=\x22background:var(--danger);\x20width:auto;\x20padding:2px\x208px;\x20font-size:10px;\x22>X</button></div>')[_0x360411(0x18d)]('');}function savePatient(){const _0x508a42=_0x157245,_0x267336={'clinic':document['getElementById'](_0x508a42(0x152))['value']||_0x508a42(0x187),'name':document[_0x508a42(0x168)]('pName')[_0x508a42(0x1a0)],'phone':document[_0x508a42(0x168)](_0x508a42(0x198))['value'],'date':document[_0x508a42(0x168)]('pDate')[_0x508a42(0x1a0)],'time':document[_0x508a42(0x168)](_0x508a42(0x15d))[_0x508a42(0x1a0)],'fee':parseFloat(document[_0x508a42(0x168)](_0x508a42(0x175))[_0x508a42(0x1a0)])||0x0,'paid':parseFloat(document['getElementById']('pPaid')[_0x508a42(0x1a0)])||0x0,'status':document[_0x508a42(0x168)](_0x508a42(0x1a1))[_0x508a42(0x1a0)],'condition':document[_0x508a42(0x168)](_0x508a42(0x18a))['value']};if(!_0x267336[_0x508a42(0x1b2)]||!_0x267336[_0x508a42(0x131)]){alert(_0x508a42(0x1bd));return;}if(editId){const _0x536577=patients[_0x508a42(0x1b1)](_0x1d4008=>_0x1d4008['id']===editId);patients[_0x536577]={..._0x267336,'id':editId},editId=null;}else patients[_0x508a42(0x13f)]({..._0x267336,'id':Date['now']()});localStorage['setItem'](_0x508a42(0x160),JSON['stringify'](patients)),resetForm(),renderPatients(),buildCalendar();}function renderPatients(){const _0x29cadf=_0x157245,_0x72a429=document[_0x29cadf(0x168)](_0x29cadf(0x12e)),_0x3ae2ec=document[_0x29cadf(0x168)](_0x29cadf(0x12f))[_0x29cadf(0x1a0)],_0x1b0514=patients['filter'](_0x2b6336=>_0x2b6336[_0x29cadf(0x131)]===_0x3ae2ec);_0x72a429[_0x29cadf(0x167)]=_0x1b0514[_0x29cadf(0x1d0)]?_0x1b0514[_0x29cadf(0x1bb)](_0x1241c5=>_0x29cadf(0x184)+_0x1241c5['status']+'\x22>'+_0x1241c5[_0x29cadf(0x130)]+_0x29cadf(0x140)+_0x1241c5['time']+_0x29cadf(0x1b5)+_0x1241c5[_0x29cadf(0x1b2)]+_0x29cadf(0x15b)+_0x1241c5['id']+_0x29cadf(0x1c1)+_0x1241c5['id']+')\x22>Edit</button><button\x20class=\x22btn-action\x22\x20style=\x22background:var(--danger)\x22\x20onclick=\x22deleteEntry('+_0x1241c5['id']+_0x29cadf(0x18c))[_0x29cadf(0x18d)](''):'<p\x20style=\x27text-align:center;color:#999\x27>No\x20entries.</p>';}function openInvoice(_0xef29e5){const _0x38545d=_0x157245,_0x105428=patients['find'](_0x2eb861=>_0x2eb861['id']===_0xef29e5);if(!_0x105428)return;document[_0x38545d(0x168)](_0x38545d(0x1b7))['innerText']=_0x105428[_0x38545d(0x165)],document[_0x38545d(0x168)](_0x38545d(0x164))[_0x38545d(0x13e)]=_0x105428[_0x38545d(0x1b2)],document['getElementById'](_0x38545d(0x1a4))['innerText']=_0x105428['phone']||_0x38545d(0x16d),document['getElementById'](_0x38545d(0x1ca))[_0x38545d(0x13e)]=_0x105428['date'],document[_0x38545d(0x168)](_0x38545d(0x1b3))['innerText']=_0x105428['time']||_0x38545d(0x149),document[_0x38545d(0x168)]('inv-fee')[_0x38545d(0x13e)]=_0x105428['fee'],document[_0x38545d(0x168)](_0x38545d(0x1c5))['innerText']=_0x105428[_0x38545d(0x1cb)],document[_0x38545d(0x168)](_0x38545d(0x189))[_0x38545d(0x13e)]=_0x105428[_0x38545d(0x1c0)]-_0x105428[_0x38545d(0x1cb)],document[_0x38545d(0x168)](_0x38545d(0x137))[_0x38545d(0x154)][_0x38545d(0x188)]=_0x38545d(0x1c7);}function _0x495c(_0x55edaf,_0x4650ed){_0x55edaf=_0x55edaf-0x12e;const _0x54a2f0=_0x54a2();let _0x495cd8=_0x54a2f0[_0x55edaf];return _0x495cd8;}function closeInvoice(){const _0x418f28=_0x157245;document['getElementById'](_0x418f28(0x137))[_0x418f28(0x154)][_0x418f28(0x188)]=_0x418f28(0x166);}function renderBilling(){const _0x5b990f=_0x157245;let _0x3c8de3=0x0,_0x2165d7=0x0;document[_0x5b990f(0x168)](_0x5b990f(0x146))[_0x5b990f(0x167)]=patients[_0x5b990f(0x1bb)](_0x45220a=>{const _0x72b881=_0x5b990f;return _0x3c8de3+=_0x45220a[_0x72b881(0x1c0)],_0x2165d7+=_0x45220a[_0x72b881(0x1cb)],'<div\x20class=\x22item\x22><div\x20class=\x22item-info\x22><b>'+_0x45220a[_0x72b881(0x1b2)]+_0x72b881(0x19a)+_0x45220a['date']+_0x72b881(0x1a5)+_0x45220a[_0x72b881(0x1c0)]+'<br>Paid:\x20'+_0x45220a[_0x72b881(0x1cb)]+'</div></div>';})[_0x5b990f(0x18d)](''),document[_0x5b990f(0x168)](_0x5b990f(0x1b4))['innerText']=_0x3c8de3,document[_0x5b990f(0x168)](_0x5b990f(0x197))['innerText']=_0x2165d7,document['getElementById'](_0x5b990f(0x16c))[_0x5b990f(0x13e)]=_0x3c8de3-_0x2165d7;}function buildCalendar(){const _0x49214a=_0x157245,_0x16982a=document[_0x49214a(0x168)](_0x49214a(0x196)),_0x24a73f=currentViewDate['getFullYear'](),_0x51c489=currentViewDate['getMonth']();document['getElementById'](_0x49214a(0x159))[_0x49214a(0x13e)]=currentViewDate['toLocaleString'](_0x49214a(0x1d2),{'month':_0x49214a(0x193),'year':_0x49214a(0x173)});const _0x21e0a7=new Date(_0x24a73f,_0x51c489,0x1)[_0x49214a(0x13b)](),_0x5d0720=new Date(_0x24a73f,_0x51c489+0x1,0x0)[_0x49214a(0x1ab)](),_0x397db7=document[_0x49214a(0x168)](_0x49214a(0x12f))[_0x49214a(0x1a0)],_0x4c341b=new Date()[_0x49214a(0x144)]()[_0x49214a(0x19b)]('T')[0x0];let _0x326416='';for(let _0x4b4ae0=0x0;_0x4b4ae0<_0x21e0a7;_0x4b4ae0++)_0x326416+=_0x49214a(0x191);for(let _0x3a94eb=0x1;_0x3a94eb<=_0x5d0720;_0x3a94eb++){const _0x38d2f6=_0x24a73f+'-'+String(_0x51c489+0x1)[_0x49214a(0x1a6)](0x2,'0')+'-'+String(_0x3a94eb)[_0x49214a(0x1a6)](0x2,'0'),_0x3576b8=patients[_0x49214a(0x17d)](_0x92ceb4=>_0x92ceb4[_0x49214a(0x131)]===_0x38d2f6)[_0x49214a(0x1d0)];let _0x166591='day';if(_0x38d2f6===_0x4c341b)_0x166591+=_0x49214a(0x14f);if(_0x38d2f6===_0x397db7)_0x166591+=_0x49214a(0x13a);_0x326416+=_0x49214a(0x17b)+_0x166591+'\x22\x20onclick=\x22selectDate(\x27'+_0x38d2f6+_0x49214a(0x1be)+_0x3a94eb+(_0x3576b8>0x0?_0x49214a(0x155)+_0x3576b8+_0x49214a(0x1a9):'')+_0x49214a(0x1b8);}_0x16982a[_0x49214a(0x167)]=_0x326416;}function selectDate(_0x46bda9){const _0x97d65=_0x157245;document[_0x97d65(0x168)](_0x97d65(0x12f))[_0x97d65(0x1a0)]=_0x46bda9,buildCalendar(),renderPatients();}function jumpToDate(_0x40d579){const _0x58ce19=_0x157245;if(!_0x40d579)return;const [_0x397491,_0x2e82be]=_0x40d579[_0x58ce19(0x19b)]('-');currentViewDate=new Date(_0x397491,_0x2e82be-0x1,0x1),buildCalendar();}function syncCalendarWithPicker(_0xee04a7){const _0x4ab9e0=_0x157245;if(!_0xee04a7)return;const _0x4cf15f=new Date(_0xee04a7);currentViewDate=new Date(_0x4cf15f[_0x4ab9e0(0x1c4)](),_0x4cf15f[_0x4ab9e0(0x1a8)](),0x1),buildCalendar();}function resetForm(){const _0x3710bd=_0x157245;editId=null,[_0x3710bd(0x1c3),_0x3710bd(0x198),_0x3710bd(0x175),_0x3710bd(0x1bf),_0x3710bd(0x18a),_0x3710bd(0x15d)][_0x3710bd(0x158)](_0x1f5809=>document[_0x3710bd(0x168)](_0x1f5809)[_0x3710bd(0x1a0)]=''),document['getElementById'](_0x3710bd(0x152))[_0x3710bd(0x1a0)]='',document[_0x3710bd(0x168)](_0x3710bd(0x14c))[_0x3710bd(0x13e)]=_0x3710bd(0x14d),document[_0x3710bd(0x168)](_0x3710bd(0x15a))[_0x3710bd(0x154)][_0x3710bd(0x188)]='none';}function goToEdit(_0x3e5213){const _0x51849f=_0x157245;editId=_0x3e5213;const _0x5ab9c5=patients[_0x51849f(0x16b)](_0xae6c77=>_0xae6c77['id']===_0x3e5213);document[_0x51849f(0x168)](_0x51849f(0x152))[_0x51849f(0x1a0)]=_0x5ab9c5[_0x51849f(0x165)]||'',document['getElementById']('pName')['value']=_0x5ab9c5[_0x51849f(0x1b2)],document[_0x51849f(0x168)](_0x51849f(0x198))['value']=_0x5ab9c5[_0x51849f(0x18e)],document[_0x51849f(0x168)](_0x51849f(0x12f))['value']=_0x5ab9c5['date'],document[_0x51849f(0x168)](_0x51849f(0x15d))['value']=_0x5ab9c5[_0x51849f(0x147)],document['getElementById']('pFee')[_0x51849f(0x1a0)]=_0x5ab9c5[_0x51849f(0x1c0)],document[_0x51849f(0x168)](_0x51849f(0x1bf))[_0x51849f(0x1a0)]=_0x5ab9c5[_0x51849f(0x1cb)],document['getElementById']('pStatus')[_0x51849f(0x1a0)]=_0x5ab9c5['status'],document[_0x51849f(0x168)](_0x51849f(0x18a))[_0x51849f(0x1a0)]=_0x5ab9c5[_0x51849f(0x14b)],document['getElementById']('saveBtn')[_0x51849f(0x13e)]=_0x51849f(0x162),document[_0x51849f(0x168)](_0x51849f(0x15a))['style'][_0x51849f(0x188)]=_0x51849f(0x1c7),window[_0x51849f(0x178)](0x0,0x0),showPage(_0x51849f(0x156));}function deleteEntry(_0x2e2551){const _0x2af1c4=_0x157245;confirm(_0x2af1c4(0x1b9))&&(patients=patients[_0x2af1c4(0x17d)](_0x120e45=>_0x120e45['id']!==_0x2e2551),localStorage['setItem']('pt_patients',JSON[_0x2af1c4(0x1ad)](patients)),renderPatients(),renderStorage(),buildCalendar());}function renderStorage(){const _0x5e1d56=_0x157245;document[_0x5e1d56(0x168)](_0x5e1d56(0x19d))[_0x5e1d56(0x13e)]=patients['length'],document[_0x5e1d56(0x168)](_0x5e1d56(0x192))[_0x5e1d56(0x167)]=patients['map'](_0x175a7d=>_0x5e1d56(0x19e)+_0x175a7d['name']+_0x5e1d56(0x19a)+_0x175a7d[_0x5e1d56(0x18e)]+_0x5e1d56(0x182)+_0x175a7d['id']+_0x5e1d56(0x1c9))[_0x5e1d56(0x18d)]('');}function applyFilters(){const _0x31df83=_0x157245,_0x2f22c9=document['getElementById'](_0x31df83(0x170))['value'][_0x31df83(0x172)]();document[_0x31df83(0x168)](_0x31df83(0x192))[_0x31df83(0x167)]=patients['filter'](_0x8149c=>_0x8149c[_0x31df83(0x1b2)][_0x31df83(0x172)]()['includes'](_0x2f22c9))[_0x31df83(0x1bb)](_0x1f5e68=>'<div\x20class=\x22item\x22><div\x20class=\x22item-info\x22><b>'+_0x1f5e68[_0x31df83(0x1b2)]+_0x31df83(0x181)+_0x1f5e68['id']+')\x22>Edit</button></div>')[_0x31df83(0x18d)]('');}function exportToCSV(){const _0x58fa50=_0x157245;let _0x2d4198=_0x58fa50(0x145)+patients[_0x58fa50(0x1bb)](_0x5adfec=>_0x5adfec[_0x58fa50(0x131)]+','+_0x5adfec[_0x58fa50(0x147)]+',\x22'+_0x5adfec[_0x58fa50(0x1b2)]+'\x22,'+_0x5adfec[_0x58fa50(0x1c0)]+','+_0x5adfec['paid']+',\x22'+_0x5adfec['status']+'\x22,\x22'+_0x5adfec[_0x58fa50(0x165)]+'\x22')[_0x58fa50(0x18d)]('\x0a');const _0x2c44d7=document['createElement']('a');_0x2c44d7['href']='data:text/csv;charset=utf-8,'+encodeURI(_0x2d4198),_0x2c44d7[_0x58fa50(0x143)]=_0x58fa50(0x1a2),_0x2c44d7[_0x58fa50(0x14e)]();}function importFromCSV(_0x54879c){const _0x4bed0c=_0x157245,_0x5c2859=_0x54879c[_0x4bed0c(0x1d1)][_0x4bed0c(0x134)][0x0];if(!_0x5c2859)return;const _0x464bb9=new FileReader();_0x464bb9[_0x4bed0c(0x13d)]=function(_0x48b2a5){const _0x4b7aba=_0x4bed0c,_0x1be386=_0x48b2a5['target'][_0x4b7aba(0x14a)][_0x4b7aba(0x19b)]('\x0a');if(_0x1be386[_0x4b7aba(0x1d0)]<0x2)return;const _0x100615=new Set(patients[_0x4b7aba(0x1bb)](_0x1f3e3c=>_0x1f3e3c[_0x4b7aba(0x1b2)][_0x4b7aba(0x172)]()+'|'+_0x1f3e3c[_0x4b7aba(0x131)]+'|'+_0x1f3e3c[_0x4b7aba(0x147)])),_0x5e3b7d=[];let _0x2f55da=0x0;for(let _0x51f8f7=0x1;_0x51f8f7<_0x1be386[_0x4b7aba(0x1d0)];_0x51f8f7++){const _0xcc1a0f=_0x1be386[_0x51f8f7]['split'](/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);if(_0xcc1a0f['length']<0x6)continue;const _0x2a7c28=_0xcc1a0f[0x2]['replace'](/"/g,'')['trim'](),_0x597e0d=_0xcc1a0f[0x0][_0x4b7aba(0x1c2)](),_0x118c63=_0xcc1a0f[0x1]['trim'](),_0x3932ce=_0x2a7c28[_0x4b7aba(0x172)]()+'|'+_0x597e0d+'|'+_0x118c63;_0x100615[_0x4b7aba(0x190)](_0x3932ce)?_0x2f55da++:(_0x5e3b7d[_0x4b7aba(0x13f)]({'id':Date[_0x4b7aba(0x194)]()+Math[_0x4b7aba(0x199)](),'date':_0x597e0d,'time':_0x118c63,'name':_0x2a7c28,'fee':parseFloat(_0xcc1a0f[0x3])||0x0,'paid':parseFloat(_0xcc1a0f[0x4])||0x0,'status':_0xcc1a0f[0x5][_0x4b7aba(0x183)](/"/g,'')[_0x4b7aba(0x1c2)](),'clinic':_0xcc1a0f[0x6]?_0xcc1a0f[0x6][_0x4b7aba(0x183)](/"/g,'')[_0x4b7aba(0x1c2)]():_0x4b7aba(0x187),'phone':'','condition':''}),_0x100615[_0x4b7aba(0x163)](_0x3932ce));}_0x5e3b7d[_0x4b7aba(0x1d0)]>0x0&&(confirm(_0x4b7aba(0x139)+_0x5e3b7d['length']+_0x4b7aba(0x17c)+_0x2f55da+'\x20skipped).\x20Merge?')&&(patients=[...patients,..._0x5e3b7d],localStorage[_0x4b7aba(0x1cc)](_0x4b7aba(0x160),JSON[_0x4b7aba(0x1ad)](patients)),buildCalendar(),renderPatients(),renderStorage(),alert(_0x4b7aba(0x174))));},_0x464bb9[_0x4bed0c(0x148)](_0x5c2859),_0x54879c[_0x4bed0c(0x1d1)][_0x4bed0c(0x1a0)]='';}function factoryReset(){const _0x33ec51=_0x157245;confirm(_0x33ec51(0x161))&&(confirm(_0x33ec51(0x171))&&(localStorage[_0x33ec51(0x132)](_0x33ec51(0x160)),localStorage[_0x33ec51(0x132)](_0x33ec51(0x15e)),patients=[],clinics=[],location['reload']()));}function changeMonth(_0x573dfe){const _0x2dc0ab=_0x157245;currentViewDate[_0x2dc0ab(0x179)](currentViewDate[_0x2dc0ab(0x1a8)]()+_0x573dfe),buildCalendar();}function refreshApp(){const _0x4ea298=_0x157245;currentViewDate=new Date(),document[_0x4ea298(0x168)](_0x4ea298(0x12f))[_0x4ea298(0x142)]=new Date(),buildCalendar(),renderPatients();}document['getElementById'](_0x157245(0x12f))[_0x157245(0x142)]=new Date(),renderClinics(),buildCalendar(),renderPatients();
</script>
</body>
</html>
